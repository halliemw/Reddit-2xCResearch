It sounds like you did the right thing. You were patient and kind, more than you really needed to be, and you could have reported him to the library supervisor earlier. In the end the guy does need to learn more about social interaction, and you gave him a chance to do that with an authority figure in his life.

It's similar to other situations where the harasser doesn't know s/he's behaving badly. You tried to correct gently, but it wasn't enough and you passed it up the chain to someone who can help.

*hugs* I would've been pretty mortified and freaked out.