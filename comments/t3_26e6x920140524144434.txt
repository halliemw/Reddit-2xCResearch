You handled it well and you did nothing wrong and your friend did betray you. I think you have to end the friendship, even though he apologized, I think he might try a similar move again.