I was in a similar situation, with a guy friend thinking it was funny to make those kind of comments, as well as sexual advances, even though he's really good friends with my SO. In the end, what shut him up was other (male) mutual friends telling him it's not cool, and he eventually cut it out with me. (Unfortunately, I don't think he's cut it out all round, but it's a start)